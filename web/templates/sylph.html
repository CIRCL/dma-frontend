<!DOCTYPE html>
<html lang="en">
<head>
  <title>&lt;3 CIRCL - DMA - Dynamic Malware Analysis - Sylph &lt;3</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Maintenance page to ease the wait">
  <meta name="author" content="CIRCL">

  <link href="static/css/style.css" rel="stylesheet">
  <link href="static/css/bootstrap.min.css" rel="stylesheet">
  <link href="static/css/bootstrap-responsive.min.css" rel="stylesheet">
  <link href="static/css/bootstrap-select.css" rel="stylesheet">
  <link href="static/css/tablecloth.css" rel="stylesheet">
  <link href="static/css/prettify.css" rel="stylesheet">
  <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
  <!--[if lt IE 9]>
    <script src="js/html5shiv.js"></script>
  <![endif]-->

  <!-- Fav and touch icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="static/img/apple-touch-icon-144-precomposed.png">
  <link rel="apple-touch-icon-precomposed" sizes="114x114" href="static/img/apple-touch-icon-114-precomposed.png">
  <link rel="apple-touch-icon-precomposed" sizes="72x72" href="static/img/apple-touch-icon-72-precomposed.png">
  <link rel="apple-touch-icon-precomposed" href="static/img/apple-touch-icon-57-precomposed.png">
  <link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}">
  <script type="text/javascript" src="static/js/jquery.min.js"></script>
  <script type="text/javascript" src="static/js/bootstrap.min.js"></script>
  <script type="text/javascript" src="static/js/scripts.js"></script>
  <script type="text/javascript" src="static/js/bootstrap-select.js"></script>
  <script src="static/js/jquery.metadata.js"></script>
  <script src="static/js/jquery.tablesorter.min.js"></script>
  <script src="static/js/jquery.tablecloth.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.0/angular.min.js"></script>

  <script type="text/javascript">
    ​document.getElementById('retmax').value = '{{ retmax }}';​​​​​​​​​​
      $(document).ready(function(e) {
          $('.selectpicker').on('change', function(){
          var selected = $(this).find("option:selected").val();
          //alert(selected);
          });
      });
  </script>
  <script type="text/javascript" charset="utf-8">
    $(document).ready(function() {
      $("table").tablecloth({
        sortable: true,
        condensed: true,
        striped: true,
        bordered: true
      });
    });
  </script>
</head>

<body background="static/img/sylph.png">

<div class="container-fluid">
    <div class="row-fluid">
        <div class="span12">
            <div class="navbar">
                <div class="navbar-inner">
                    <div class="container-fluid">
                        <a data-target=".navbar-responsive-collapse" data-toggle="collapse" class="btn btn-navbar"><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></a> <a href="" class="brand"><img src="static/img/dma.png" class="img-rounded"/>(BETA v2)</a><img src="static/img/sylp_icon.png" class="img-rounded"/>
                        <div class="nav-collapse collapse navbar-responsive-collapse">
                            <ul class="nav pull-right">
                                <li> </li>
                                <li>Logged as <b>{{ user }}</b></li>
                                <li class="divider-vertical"> </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <div class="hero-unit">
                <p class="lead">
                Welcome to the sylph interface of DMA.
                </p>
            {% if e %}
            <div class="panel panel-primary panel-default">
                <div class="panel-heading">Malicious sample upload interface is temporarily ERROR, see error(s) below.</div>
                <div class="panel-body"> {{ e }} </div>
            </div>
            {% endif %}
        </div>
    </div>
    {% if s %}
        <div class="hero-unit">
            <div class="panel panel-primary panel-default">
                <div class="col-lg-10">
                    <form role="form" method="POST" enctype="multipart/form-data" action="{{ urlPath+url_for('sylph') }}">
                        <select class="form-control selectpicker" id="retmax" name="retmax" onchange="this.form.submit()">
                            <option value={{ retmax }} selected>Showing: {{ retmax }}</option>
                            <option>5</option>
                            <option>10</option>
                            <option>30</option>
                            <option>60</option>
                            <option>70</option>
                            <option>all</option>
                        </select>
                        {% if errors == 'NOERR' %}
                            <input name="errors" type="checkbox" value="ERR"/> Show Failed Analysis
                        {% else %}
                            <input name="errors" type="checkbox" checked value="ERR"/> Show Failed Analysis
                        {% endif %}
                        <input name="errors" type="hidden" checked value="NOERR"/>
                    </form>
                </div>
                <div class="panel-heading">Status of uploaded sample</div>
                <table class="table table-hover table-condensed btable tablehead">
                    <thead>
                        <!-- PDF -->
                        <col width="50">
                        <!-- Task ID -->
                        <col width="80">
                        <!-- Submitter -->
                        <col width="100">
                        <!-- cuckoo Flav -->
                        <col width="140">
                        <!-- Sample -->
                        <col width="250">
                        <!-- Status -->
                        <col width="130">
                        {% if errors == 'ERR' %}
                            <!-- Error(s) -->
                            <col width="">
                        {% endif %}
                        <!-- System -->
                        <col width="300">
                        <!-- Date -->
                        <col width="200">
                        <!-- uuid -->
                        <col width="200">
                        <!-- Header of analysis -->
                        {% if errors == 'ERR' %}
                            <tr><th>PDF</th><th>Task id</th><th>Submitter</th><th>cuckoo flavour<th>Sample</th><th>Status</th><th>Error(s)</th><th>System</th><th>Date</th><th>uuid</th></tr>
                        {% else %}
                            <tr><th>PDF</th><th>Task id</th><th>Submitter</th><th>cuckoo flavour<th>Sample</th><th>Status</th><th>System</th><th>Date</th><th>uuid</th></tr>
                        {% endif %}
                    </thead>

                        {% for t in s %}
                        <!-- Set the row colour to red or green-->
                        {% if t['task']['errors']|length > 0 %}
                            <tr class="error">
                        {% elif t['task']['status'] == 'failed_analysis' %}
                            <tr class="error">
                        {% elif t['task']['status'] == 'reported' %}
                            <tr class="success">
                        {% elif t['task']['status'] == 'running' %}
			    <tr class="warning">
                        {% else %}
                            <tr class="error">
                        {% endif %}
                          {#       {% if errors == 'ERR' %}
                                    {% if not t['task']['errors'] %} #}
                                        <!-- PDF -->
                                        <td>
                                        {% if t['task']['status'] == 'reported' %}
                                            <a href="{{ urlPath }}/pfetch/{{ t['task']['id'] }}" target="_blank"><img src="static/img/Pdf-Icon-fs8.png" style="height:40px;border:0"></a>
                                        {% else %}
                                            N/A
                                        {% endif %}
                                        </td>
                                        <!-- Task id -->
                                        <td>
                                        {% if t['task']['status'] == 'reported' %}
                                            <a href="{{ urlPath }}/rfetch/{{ t['task']['id'] }}" target="_blank">{{ t['task']['id'] }}</a>
                                        {% else %}
                                            {{ t['task']['id'] }}
                                        {% endif %}
                                        </td>
                                        <!-- Submitter -->
                                        <td>{{ user }}</td>
                                        <!-- cuckoo flavour -->
                                        {% if cuckooStatus['version'] == '1.3-Optiv' %}
                                            <td>modified<br />Optiv v1.3</td>
                                        {% elif cuckooStatus['version'] == '1.3-NG' %}
                                            <td>modified<br />Spender v1.3</td>
                                        {% else %}
                                            <td>vanilla v2.0-HEAD</td>
                                        {% endif %}
                                        <!-- Sample -->
                                        <td> {{ t['task']['target'].split("/")[4] }} </td>
                                        <!-- Status -->
                                        <td> {{ t['task']['status'] }} </td>
                                        <!-- Error(s) -->
                                        {% if errors == 'ERR' %}
                                            <td>
                                                {% if t['task']['errors']|length > 0 %}
                                                    {{ t['task']['errors'][0] }}
                                                {% endif %}
                                            </td>
                                        {% endif %}
                                        <!-- System -->
                                        <td> {{ t['task']['guest']['name'] }} </td>
                                        <!-- Date -->
                                        <td> {{ t['task']['completed_on'] }} </td>
                                        <!-- uuid -->
                                        <td> {{ t['task']['uuid'] }} </td>
                                {#    {% endif %}
                                {% endif %} #}
                            </tr>
                    {% endfor %}
                </table>
            </div>
        </div>
    </div>
    {% endif %}
</div>

<div ng-app="">
    <p>Input box:</p>
    <p>Name: <input type="text" ng-model="name"></p>
    <p ng-bind="name"></p>
</div>

</body>
</html>
